angular.module("search",["core"]).config(["iocMapProvider",function(t){t.map({moviesGateway:"httpMoviesGateway"})}]).constant("SEARCHURL","app/modules/search/"),angular.module("search").factory("PaginatedMovies",["BaseCollection",function(t){var e=t.extend({total:0,pagination:{},setPagination:function(t){this.resetPagination(),angular.extend(this.pagination,t)},resetPagination:function(){for(var t in this.pagination)delete this.pagination[t]}});return new e}]),angular.module("search").constant("SEARCH_ENDPOINT","movies.json").factory("httpMoviesGateway",["httpGateway","SEARCH_ENDPOINT",function(t,e){return{search:function(n,o){return t.jsonp(e,_.defaults({},o,{q:n}))}}}]),angular.module("search").directive("searchForm",["formBuilder","SEARCHURL",function(t,e){return t({templateUrl:e+"components/form.tmpl.html",formName:"searchForm"})}]),angular.module("search").value("paginationDefaults",{page_limit:10}).factory("searchMovies",["PaginatedMovies","paginationDefaults","moviesGateway",function(t,e,n){return function(o,r){return r=_.defaults(r||{},e),n.search(o,r).then(function(e){t.set(e.data.movies),t.total=e.data.total,t.setPagination(_.extend({total:e.data.total},r))})}}]),angular.module("login",["ngStorage","core"]).constant("LOGINURL","app/modules/login/"),angular.module("login").directive("signinForm",["formBuilder","LOGINURL",function(t,e){return t({templateUrl:e+"components/form.tmpl.html",formName:"signinForm"})}]),angular.module("login").factory("login",["User","userGateway","cfpLoadingBar",function(t,e,n){return function(o){return n.start(),e.validCredentials(o).then(function(){user={username:o.username,isLoggedIn:!0},e.saveToClient(user),t.set(user),n.complete()})}}]),angular.module("routes",["core","modules","ui.router"]).constant("ROUTESURL","app/routes/").constant("URLMAP",{home:"/",search:"/search",signin:"/login"}).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(t,e){t.state("root",{"abstract":!0,template:"<ui-view></ui-view>"}),e.otherwise("/")}]).factory("globalResolve",["$q","fetchUserFromClient",function(t,e){return t.all([e()])}]).run(["globalResolve","$rootScope","User","$state","$stateParams","cfpLoadingBar",function(t,e,n,o,r,a){e.$on("$stateChangeStart",function(r,i,s,l,u){return a.start(),i.publicRoute?!0:(r.preventDefault(),void t.then(function(){1!=n.isLoggedIn()?o.transitionTo("root.signin"):o.transitionTo(i.name,s,{notify:!1}).then(function(){e.$broadcast("$stateChangeSuccess",i,s,l,u)})}))}),e.$on("$stateChangeSuccess",function(){a.complete()}),e.$on("$stateChangeError",function(t,e,n,o,r,a){console.error(a)})}]),angular.module("routes").config(["$stateProvider","URLMAP","ROUTESURL",function(t,e,n){t.state("root.signin",{url:e.signin,templateUrl:n+"signin/signin.tmpl.html",controller:"SigninCtrl",controllerAs:"signin",publicRoute:!0,resolve:{redir:["User","$location",function(t,e){t.isLoggedIn()&&e.path("/")}]}})}]).controller("SigninCtrl",["login","$state",function(t,e){var n=this;n.user={},n.submitLogin=function(){return t(n.user).then(function(){e.go("root.home")})}}]),angular.module("routes").config(["$stateProvider","URLMAP","ROUTESURL",function(t,e,n){t.state("root.search",{url:e.search,templateUrl:n+"search/search.tmpl.html",controllerAs:"search",controller:"SearchCtrl",resolve:{}})}]).controller("SearchCtrl",["searchMovies","PaginatedMovies",function(t,e){var n=this;n.searchResults=e.get(),n.searchTotal=e.total,n.pagination=e.pagination,n.entity={keyword:"Jaws"},n.submitSearch=function(){return t(n.entity.keyword,{page:1})}}]),angular.module("routes").config(["$stateProvider","URLMAP","ROUTESURL",function(t,e,n){t.state("root.home",{url:e.home,templateUrl:n+"home/home.tmpl.html",controller:"HomeCtrl",publicRoute:!0,resolve:{}})}]).controller("HomeCtrl",function(){}),angular.module("navbar",["core","mgcrea.ngStrap","ui.router"]).constant("NAVBARURL","app/modules/navbar/").directive("navigationBar",["NAVBARURL",function(t){return{scope:{navigation:"="},templateUrl:t+"navbar.tmpl.html",controllerAs:"navbar",bindToController:!0,controller:function(){var t=this;t.brand=_.find(t.navigation,{brand:!0})||t.navigation[0]}}}]),angular.module("core",["ngCookies","ngTouch","ngAnimate","ngSanitize","angular-loading-bar"]).constant("COREURL","app/core/").config(["iocMapProvider","cfpLoadingBarProvider",function(t,e){t.map({userGateway:"lsUserGateway"}),e.includeSpinner=!1}]),angular.module("core").provider("iocMap",["$provide",function(t){this.map=function(e){_.each(e,function(e,n){var o=function(t){return t};o.$inject=[e],t.factory(n,o)})},this.$get=[]}]),angular.module("core").factory("formBuilder",["$q",function(t){return function(e){return angular.extend({},{scope:{entity:"=entity",submitFn:"&submitFn"},transclude:!0,bindToController:!0,controllerAs:"form",controller:function(n){if(null==this.entity)throw new Error("Form requires entity");var o=this.original=angular.copy(this.entity);this.submit=function(){t.when(this.submitFn()(this.entity)).then(function(){n[e.formName].$setPristine(),n[e.formName].$setUntouched()})},n.$watchCollection("form.entity",function(t){return n[e.formName].$pristine?(null==t.id&&angular.extend(n.form.entity,e.defaults),!0):void angular.forEach(e.validators,function(r,a){n[e.formName].$setValidity(a,r(t,o))})}),this.modelOptions={updateOn:"default blur",debounce:{"default":200,blur:0}}}},e)}}]),angular.module("core").factory("extendPrototype",function(){return function(t,e){var n,o=this;n=t&&_.has(t,"constructor")?t.constructor:function(){return o.apply(this,arguments)},_.assign(n,o,e);var r=function(){this.constructor=n};return r.prototype=o.prototype,n.prototype=new r,t&&_.assign(n.prototype,t),n.__super__=o.prototype,n}}),angular.module("core").factory("User",["BaseEntity",function(t){var e=t.extend({constructor:function(){t.apply(this,arguments),this.set("isLoggedIn",!1)},isLoggedIn:function(){return this.get("isLoggedIn")}});return new e}]),angular.module("core").factory("BaseEntity",["extendPrototype",function(t){function e(){this.data={}}return e.prototype.set=function(t,e){"string"==typeof t?this.data[t]=e:(this.reset(),this.assign(this.data,t))},e.prototype.get=function(t){return null==t?this.data:this.data[t]},e.prototype.reset=function(){for(var t in this.data)delete this.data[t]},_.each(["assign","has","findKey","forIn","isEmpty","keys","clone","pick","mapValues"],function(t){e.prototype[t]=function(){var e=Array.prototype.slice.call(arguments,0);return _[t].apply(_,[this.data].concat(e))}}),e.extend=t,e}]),angular.module("core").factory("BaseCollection",["extendPrototype",function(t){function e(){this.list=[]}return e.prototype.get=function(t){return null!=t?this.find({id:t}):this.list},e.prototype.add=function(t){this.list.push(t)},e.prototype.set=function(t){this.reset(),angular.extend(this.list,t)},e.prototype.reset=function(){this.list.length=0},_.each(["where","find","filter","forEach","map","max","min","pluck","sortBy","reject","remove"],function(t){e.prototype[t]=function(){var e=Array.prototype.slice.call(arguments,0);return _[t].apply(_,[this.list].concat(e))}}),e.extend=t,e}]),angular.module("core").constant("SECRETPASSWORD","cheese").constant("USER_KEY","localStorageUser").factory("lsUserGateway",["$q","$localStorage","USER_KEY","SECRETPASSWORD",function(t,e,n,o){return{validCredentials:function(e){return t(function(t,n){e.password==o?t():n()})},saveToClient:function(o){return t(function(t){e[n]=o,t()})},getFromClient:function(){return t(function(t){t(e[n])})}}}]),angular.module("core").value("API_BASE_URL",null).value("API_KEY",null).factory("httpGateway",["$http","API_BASE_URL","API_KEY",function(t,e,n){function o(){if(_.isEmpty(e))throw Error("http requires API_BASE_URL");if(_.isEmpty(n))throw Error("http requires API_KEY")}function r(e){return o(),t(_.defaults({},e,{cache:!0})).error(function(t){console.error(t)})}return{jsonp:function(t,o){return r({method:"JSONP",url:e+t,params:_.defaults({},o||{},{apikey:n,callback:"JSON_CALLBACK"})})}}}]),angular.module("core").factory("fetchUserFromClient",["User","userGateway",function(t,e){return function(){return e.getFromClient().then(function(e){null!=e&&t.set(e)})}}]),angular.module("modules",["search","navbar","login"]),angular.module("config",[]).value("LOCAL_CONFIG",!1).constant("NAVIGATION",{guestNav:[{name:"root.signin",path:"/signin",label:"Signup"}],userNav:[{name:"root.home",path:"/home",label:"Home"},{name:"root.search",path:"/search",label:"Search"}]}).constant("API_KEY","nd3uzzypjhqxjqhujpqukdsu").constant("API_BASE_URL","http://api.rottentomatoes.com/api/public/v1.0/"),angular.module("config").constant("LOCAL_CONFIG",{env:"DEV"}).config(function(){}).run(["User",function(){}]),angular.module("tfIntensiveRottentomsApp",["config","core","routes","navbar"]).run(["$rootScope","LOCAL_CONFIG","NAVIGATION","User",function(t,e,n,o){e&&console.info("Current Local Config:",e),t.user=o.get(),t.$watch("user.isLoggedIn",function(e){t.navigation=e?n.userNav:n.guestNav})}]),angular.module("tfIntensiveRottentomsApp").run(["$templateCache",function(t){t.put("app/modules/navbar/navbar.tmpl.html",'<div class="navbar navbar-default" role="navigation" bs-navbar=""><div class="navbar-header"><a class="navbar-brand" ui-sref="{{::navbar.brand.name}}">Angular Intensive</a></div><ul class="nav navbar-nav"><li ng-repeat="nav in navbar.navigation" ui-sref-active="active"><a ui-sref="{{::nav.name}}">{{::nav.label}}</a></li></ul></div>'),t.put("app/routes/home/home.tmpl.html",'<div class="container"><div class="jumbotron text-center"><h1>\'Allo, \'Allo!</h1><p class="lead"><img src="assets/images/yeoman.png" alt="I\'m Yeoman"><br>Always a pleasure scaffolding your apps.</p><p><a class="btn btn-lg btn-success" ng-href="#">Splendid!</a></p></div></div>'),t.put("app/routes/search/search.tmpl.html",'<div class="container"><search-form entity="search.entity" submit-fn="search.submitSearch"></search-form><h3>Search</h3><table class="table table-striped table-hover" ng-if="search.searchResults.length"><thead><tr><th>Title</th><th>Year</th><th>Rating</th><th>Runtime</th></tr></thead><tbody><tr ng-repeat="movie in search.searchResults track by movie.id"><td>{{ :: movie.title }}</td><td>{{ :: movie.year }}</td><td>{{ :: movie.mpaa_rating }}</td><td>{{ :: movie.runtime }}</td></tr></tbody></table><pre>{{ search.searchTotal | json}}</pre><pre>{{ search.pagination | json}}</pre></div>'),t.put("app/routes/signin/signin.tmpl.html",'<div class="container"><h3>Sign in</h3><signin-form entity="signin.user" submit-fn="signin.submitLogin"></signin-form></div>'),t.put("app/modules/login/components/form.tmpl.html",'<form name="signinForm" ng-submit="form.submit(form.entity)" novalidate=""><fieldset class="form-group required"><label for="keyword" class="control-label">User Name:</label> <input type="text" class="form-control" ng-model="form.entity.username" name="username" id="username" ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': 200, \'blur\': 0 } }" required=""></fieldset><fieldset class="form-group required"><label for="Keyword" class="control-label">Password:</label> <input type="password" class="form-control" ng-model="form.entity.password" name="password" id="password" ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': 200, \'blur\': 0 } }" required=""></fieldset><div class="controls"><button ng-disabled="signinForm.$invalid" type="submit" class="btn btn-success">Save</button></div></form>'),t.put("app/modules/search/components/form.tmpl.html",'<form name="searchForm" ng-submit="form.submit()" novalidate=""><fieldset class="form-group required"><label for="keyword" class="control-label">Search:</label> <input type="text" class="form-control" ng-model="form.entity.keyword" name="keyword" id="keyword" ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': 200, \'blur\': 0 } }" required=""></fieldset></form>')}]);